<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace = "dev.mvc.pay.PayDAOInter">

<!-- 등록  -->
<insert id="create" parameterType="PayVO">
  INSERT INTO pay (payno, 
                        optionlan, optionqual, optionrent,
                        priceoriginal, pricediscount, pricefinal, 
                        memberno, paytotalno, promono, filmno)
  VALUES (pay_seq.nextval, 
            #{optionlan}, #{optionqual}, #{optionrent},
            #{priceoriginal}, #{pricediscount}, #{pricefinal},
            #{memberno}, #{paytotalno}, #{promono}, #{filmno})
</insert>

<!-- 목록 -->
<select id="list" resultType="PayVO">
  SELECT payno, 
            optionlan, optionqual, optionrent,
            priceoriginal, pricediscount, pricefinal, payvalid,
            memberno, paytotalno, promono, filmno
 FROM pay           
 ORDER BY payno
</select>


<!-- Pay, Paytotal Join (memberno별 결제 내역) -->
<select id="list_by_memberno" resultType="Paytotal_Pay_Film_VO" parameterType="int">
  SELECT t.paytotalno, t.pricetotaldiscpromo, t.pricetotaldiscpnt, t.pricetotalfinal, t.pntsave, t.method, t.paytotaldate,
            p.payno, p.optionlan, p.optionqual, p.optionrent, p.pricediscount, p.pricefinal, p.filmno,
            f.titleen, f.titlekr, f.poster
  FROM pay p, paytotal t, film f
  WHERE p.paytotalno = t.paytotalno AND p.filmno = f.filmno AND p.memberno = #{memberno}
  ORDER BY payno
</select>


<!-- 조회 -->
<select id="read" resultType="PayVO" parameterType="int">
  SELECT payno, 
            optionlan, optionqual, optionrent,
            priceoriginal, pricediscount, pricefinal, payvalid,
            memberno, paytotalno, promono, filmno
    FROM pay       
  WHERE payno = #{payno}
</select>

<!-- 수정 -->
<update id="update" parameterType="PayVO" >
  UPDATE pay
  SET day1=#{day1}, day3=#{day3}, day7=#{day7}, day30=#{day30}, dayperm=#{dayperm}
  WHERE filmno = #{filmno}
</update>

<!-- 삭제 -->
<delete id="delete" parameterType="int">
  DELETE 
  FROM pay
  WHERE payno= #{payno}
</delete>

</mapper>